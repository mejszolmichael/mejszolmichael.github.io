<!DOCTYPE html>
<html>
<head>
    <title>mObywatel - Skaner QR</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="assets/card.css?v=1.0">
    <link rel="stylesheet" href="assets/main.css">
    <link rel="stylesheet" href="assets/qrscan.css">
    <link rel="icon" type="image/x-icon" href="images/coi_common_ui_ic_mobywatel_logo.svg">
    <link rel="apple-touch-icon" href="images/app_icon_240.webp">
    <link rel="shortcut icon" href="images/coi_common_ui_ic_mobywatel_logo.svg">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <script src="assets/jsQR.js"></script>
</head>
<body>
    <div class="top_grid">
        <div class="action_grid">
            <img src="images/ic_arrow_forward_Dgray.svg" class="back_img rotate90">
            <p onclick="sendTo('qr.html')" class="back_text">Wróć</p>
        </div>
        <p class="title_text">Zeskanuj kod QR</p>
        <img src="images/coi_common_ui_ic_help.svg" class="help_img">
    </div>

    <div class="qr_scanner_container">
        <p class="scanner_title"></p>
        <p class="description">Umieść kod QR w ramce, aby go zeskanować.</p>

        <div class="scanner_area">
            <video id="video" playsinline></video>
            <canvas id="canvas" style="display:none;"></canvas>

            <div class="scanner_overlay">
                <div class="scanner_frame">
                    <div class="corner tl"></div>
                    <div class="corner tr"></div>
                    <div class="corner bl"></div>
                    <div class="corner br"></div>
                </div>
            </div>

            <div id="cameraLoading" class="camera_loading">
                <div class="loading_spinner"></div>
                <p>Uruchamianie kamery…</p>
            </div>

            <!-- Tip banner -->
            <div style="position:absolute;top:10px;left:10px;right:10px;margin:auto;max-width:300px;background:#fdecc8;border:1px solid #e9d6aa;color:#1f2125;border-radius:10px;padding:10px 14px;display:flex;gap:10px;align-items:flex-start;box-shadow:0 2px 10px rgba(0,0,0,.08);">
                <div style="width:22px;height:22px;flex:0 0 22px;border-radius:50%;border:2px solid #d6b97a;display:flex;align-items:center;justify-content:center;color:#d6b97a;font-weight:700;">i</div>
                <div style="font-size:13px;line-height:1.35;font-weight:500;">Upewnij się, że kod QR pochodzi z wiarygodnego źródła.</div>
            </div>
        </div>

        <div class="manual_entry">
            <button id="manualEntryBtn" class="manual_button">Wpisz kod</button>
        </div>

        <!-- Manual input (hidden by default) -->
        <div id="manualInputContainer" class="manual_input_container" style="display:none;">
            <div class="manual_header_bar"></div>
            <input id="manualCodeInput" class="manual_input" type="text" placeholder="Wpisz 6‑cyfrowy kod" maxlength="6">
            <div class="manual_buttons">
                <button id="submitCode" class="scan_button">Dalej</button>
                <button id="cancelManual" class="scan_button secondary">Anuluj</button>
            </div>
        </div>

        <!-- Not found message (hidden) -->
        <div id="notFoundMessage" class="not_found_message" style="display:none;">
            <div class="not_found_content">
                <div class="not_found_icon">⚠️</div>
                <h3>Nie znaleziono danych</h3>
                <p>Nie udało się dopasować kodu do danych użytkownika.</p>
                <div class="not_found_actions">
                    <button class="scan_button" onclick="location.reload()">Spróbuj ponownie</button>
                    <button class="scan_button secondary" onclick="document.getElementById('manualEntryBtn').click()">Wpisz kod</button>
                </div>
            </div>
        </div>

        <!-- Scanned data (hidden) -->
        <div id="scannedData" class="scanned_data" style="display:none;">
            <div class="data_header">
                <h3>Zeskanowane dane</h3>
            </div>
            <div id="dataContent"></div>
            <div class="data_actions">
                <button class="scan_button" onclick="location.reload()">Skanuj ponownie</button>
                <button class="scan_button secondary" onclick="sendTo('qr.html')">Wróć</button>
            </div>
        </div>
    </div>

    <div class="bottom_bar">
        <div class="bottom_bar_grid">
            <div class="bottom_element_grid" send="home.html">
                <div class="bottom_element_image home"></div>
                <p class="bottom_element_text">Pulpit</p>
            </div>
            <div class="bottom_element_grid" send="documents.html">
                <div class="bottom_element_image documents"></div>
                <p class="bottom_element_text">Dokumenty</p>
            </div>
            <div class="bottom_element_grid" send="services.html">
                <div class="bottom_element_image services"></div>
                <p class="bottom_element_text">Usługi</p>
            </div>
            <div class="bottom_element_grid" send="qr.html">
                <div class="bottom_element_image qr qr_open"></div>
                <p class="bottom_element_text open">Kod QR</p>
            </div>
            <div class="bottom_element_grid" send="more.html">
                <div class="bottom_element_image more"></div>
                <p class="bottom_element_text">Więcej</p>
            </div>
        </div>
    </div>

    <script src="assets/bar.js"></script>
    <script src="assets/qrscan.js"></script>
    <script src="assets/manifest.js"></script>
</body>
</html>
